<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>BurnedStream</title>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .row-scroll { display: flex; overflow-x: auto; gap: 0.75rem; scroll-behavior: smooth; padding-bottom: 0.5rem; }
    .row-scroll::-webkit-scrollbar { display: none; }
    .card-custom { min-width: 120px; flex-shrink: 0; border-radius: 0.5rem; overflow: hidden; }
    .poster-img { height: 180px; object-fit: cover; border-radius: 0.5rem; }
    @media(min-width:768px){
      .card-custom { min-width: 160px; }
      .poster-img { height: 240px; }
    }
  </style>
</head>
<body class="bg-gray-900 text-white">
  <!-- Navbar -->
  <nav class="navbar navbar-dark bg-black px-3 fixed w-full z-50">
    <a class="navbar-brand text-lg font-bold text-red-600" href="index.html">üî• BurnedStream</a>
    <form class="d-flex">
      <input id="search" class="form-control me-2 bg-dark text-white border-0 text-sm" type="search" placeholder="Search...">
      <button class="btn btn-danger btn-sm" type="button" onclick="searchContent()">üîç</button>
    </form>
  </nav>

  <!-- Hero -->
  <section id="hero" class="relative h-[35vh] md:h-[60vh] flex items-end bg-black mt-[56px]">
    <img id="heroPoster" class="absolute inset-0 w-full h-full object-cover opacity-40">
    <div class="relative p-3">
      <h1 id="heroTitle" class="text-lg md:text-4xl font-bold mb-1"></h1>
      <a id="heroBtn" href="#" class="btn btn-danger btn-sm px-3 py-1">‚ñ∂ Watch</a>
    </div>
  </section>

  <!-- Sections -->
  <div class="container-fluid px-3 py-4">
    <h2 class="text-base md:text-xl font-bold mb-2">Movies</h2>
    <div id="moviesRow" class="row-scroll mb-4"></div>

    <h2 class="text-base md:text-xl font-bold mb-2">TV Series</h2>
    <div id="seriesRow" class="row-scroll mb-4"></div>

    <h2 class="text-base md:text-xl font-bold mb-2">All Titles</h2>
    <div id="allRow" class="row-scroll"></div>
  </div>

  <script>
    const API = "https://crew-auth.vercel.app/api";

    async function loadContent() {
      let [movies, series] = await Promise.all([
        axios.get(`${API}/content`),
        axios.get(`${API}/series`)
      ]);

      let allItems = [...movies.data, ...series.data];
      if (allItems.length) setHero(allItems[0]);

      renderRow("moviesRow", movies.data);
      renderRow("seriesRow", series.data);
      renderRow("allRow", allItems);
    }

    function setHero(item) {
      let poster = item.poster.includes("image.tmdb.org") 
        ? item.poster.replace("/w500","/w342") 
        : item.poster;
      document.getElementById("heroPoster").src = poster;
      document.getElementById("heroTitle").innerText = item.title;
      document.getElementById("heroBtn").href = `watch.html?type=${item.type}&id=${item._id}`;
    }

    function renderRow(rowId, items) {
      let row = document.getElementById(rowId);
      row.innerHTML = "";
      items.forEach(item => {
        let poster = item.poster.includes("image.tmdb.org") 
          ? item.poster.replace("/w500","/w185") 
          : item.poster;
        let card = `
          <div class="card-custom">
            <img src="${poster}" class="poster-img w-full" alt="${item.title}">
            <a href="watch.html?type=${item.type}&id=${item._id}" class="block text-xs text-center mt-1">${item.title}</a>
          </div>
        `;
        row.innerHTML += card;
      });
    }

    async function searchContent() {
      let q = document.getElementById("search").value.toLowerCase();
      let [movies, series] = await Promise.all([
        axios.get(`${API}/content`),
        axios.get(`${API}/series`)
      ]);
      let allItems = [...movies.data, ...series.data];
      let results = allItems.filter(i => i.title.toLowerCase().includes(q));
      renderRow("allRow", results);
    }

    loadContent();
  </script>
</body>
</html>
