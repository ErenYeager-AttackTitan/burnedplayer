<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>BurnedStream</title>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .scroll-row { display: flex; overflow-x: auto; gap: 0.75rem; padding: 0.5rem 0; }
    .scroll-row::-webkit-scrollbar { display: none; }
    .card { flex-shrink: 0; width: 120px; }
    .card img { border-radius: 0.5rem; object-fit: cover; width: 100%; height: 180px; }
    @media(min-width:768px){
      .card { width: 160px; }
      .card img { height: 240px; }
    }
  </style>
</head>
<body class="bg-gray-900 text-white">
  <!-- Navbar -->
  <nav class="flex items-center justify-between px-4 py-2 bg-black fixed top-0 left-0 w-full z-50">
    <a href="index.html" class="text-lg md:text-2xl font-bold text-red-500">üî• BurnedStream</a>
    <div class="flex items-center gap-2">
      <input id="search" class="bg-gray-800 text-white text-sm rounded px-2 py-1" placeholder="Search">
      <button class="bg-red-600 px-3 py-1 rounded text-sm" onclick="searchContent()">Go</button>
    </div>
  </nav>

  <!-- Hero -->
  <section id="hero" class="relative h-[45vh] md:h-[70vh] flex items-end mt-[56px]">
    <img id="heroBackdrop" class="absolute inset-0 w-full h-full object-cover opacity-50">
    <div class="relative p-4 md:p-8">
      <h1 id="heroTitle" class="text-xl md:text-5xl font-bold mb-2 drop-shadow-lg"></h1>
      <p id="heroDesc" class="hidden md:block max-w-xl text-sm mb-3"></p>
      <a id="heroBtn" href="#" class="bg-red-600 px-3 py-1 rounded text-sm md:text-base">‚ñ∂ Watch</a>
    </div>
  </section>

  <!-- Rows -->
  <div class="px-3 py-5 space-y-6">
    <div>
      <h2 class="text-base md:text-xl font-bold mb-2">üé¨ Movies</h2>
      <div id="moviesRow" class="scroll-row"></div>
    </div>
    <div>
      <h2 class="text-base md:text-xl font-bold mb-2">üì∫ Series</h2>
      <div id="seriesRow" class="scroll-row"></div>
    </div>
    <div>
      <h2 class="text-base md:text-xl font-bold mb-2">‚≠ê All Titles</h2>
      <div id="allRow" class="scroll-row"></div>
    </div>
  </div>

  <script>
    const API = "https://crew-auth.vercel.app/api";

    async function loadContent() {
      let [movies, series] = await Promise.all([
        axios.get(`${API}/content`),
        axios.get(`${API}/series`)
      ]);
      let allItems = [...movies.data, ...series.data];
      if (allItems.length) setHero(allItems[0]);
      renderRow("moviesRow", movies.data);
      renderRow("seriesRow", series.data);
      renderRow("allRow", allItems);
    }

    function setHero(item) {
      let poster = item.poster;
      if (poster.includes("image.tmdb.org")) {
        poster = poster.replace("/w500","/w780"); // use backdrop-like
      }
      document.getElementById("heroBackdrop").src = poster;
      document.getElementById("heroTitle").innerText = item.title;
      document.getElementById("heroDesc").innerText = item.description?.substring(0,120) || "";
      document.getElementById("heroBtn").href = `watch.html?type=${item.type}&id=${item._id}`;
    }

    function renderRow(id, items) {
      let row = document.getElementById(id);
      row.innerHTML = "";
      items.forEach(item => {
        let poster = item.poster.includes("image.tmdb.org") 
          ? item.poster.replace("/w500","/w185") 
          : item.poster;
        row.innerHTML += `
          <div class="card">
            <a href="watch.html?type=${item.type}&id=${item._id}">
              <img src="${poster}" alt="${item.title}">
            </a>
            <p class="text-xs mt-1 truncate">${item.title}</p>
          </div>
        `;
      });
    }

    async function searchContent() {
      let q = document.getElementById("search").value.toLowerCase();
      let [movies, series] = await Promise.all([
        axios.get(`${API}/content`),
        axios.get(`${API}/series`)
      ]);
      let results = [...movies.data, ...series.data].filter(i => i.title.toLowerCase().includes(q));
      renderRow("allRow", results);
    }

    loadContent();
  </script>
</body>
</html>
