<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Watch - BurnedStream</title>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .ep-btn { padding: 0.5rem; font-size: 0.9rem; border-radius: 0.5rem; }
  </style>
</head>
<body class="bg-gray-900 text-white">
  <!-- Poster Banner -->
  <div class="relative h-[30vh] md:h-[50vh]">
    <img id="poster" class="absolute inset-0 w-full h-full object-cover opacity-30">
    <div class="relative p-3 md:p-6">
      <h1 id="title" class="text-lg md:text-4xl font-bold drop-shadow-lg"></h1>
      <p id="desc" class="text-xs md:text-base my-2 line-clamp-3"></p>
      <p class="text-yellow-400">⭐ <span id="rating"></span></p>
    </div>
  </div>

  <!-- Player -->
  <div class="w-full h-[45vh] md:h-[70vh] bg-black">
    <iframe id="player" class="w-full h-full" allowfullscreen></iframe>
  </div>

  <!-- Episodes (for series) -->
  <div id="episodes" class="p-3 hidden">
    <h2 class="text-base md:text-xl font-bold mb-3">Episodes</h2>
    <div id="epList" class="grid grid-cols-2 md:grid-cols-6 gap-2"></div>
  </div>

  <script>
    const API = "https://crew-auth.vercel.app/api";
    const params = new URLSearchParams(window.location.search);
    const id = params.get("id");
    const type = params.get("type");

    async function loadVideo() {
      if (!id || !type) {
        document.body.innerHTML = "<h1 class='text-center mt-20'>❌ Invalid request</h1>";
        return;
      }

      let endpoint = type === "tv" ? "series" : "content";
      let res = await axios.get(`${API}/${endpoint}`);
      let item = res.data.find(x => x._id === id);

      if (!item) {
        document.body.innerHTML = "<h1 class='text-center mt-20'>❌ Not found</h1>";
        return;
      }

      // Use lower quality TMDB poster if available
      let poster = item.poster.includes("image.tmdb.org") 
        ? item.poster.replace("/w500","/w342") 
        : item.poster;
      document.getElementById("poster").src = poster;
      document.getElementById("title").innerText = item.title;
      document.getElementById("desc").innerText = item.description;
      document.getElementById("rating").innerText = item.rating || "N/A";

      if (type === "movie") {
        document.getElementById("player").src = `https://burnedplayer.pages.dev/player?v=${item.slug}`;
      }

      if (type === "tv") {
        document.getElementById("episodes").classList.remove("hidden");
        let epList = document.getElementById("epList");
        epList.innerHTML = "";
        item.episodes.forEach((ep, idx) => {
          epList.innerHTML += `
            <button class="bg-gray-800 text-white ep-btn hover:bg-red-600" onclick="playEpisode('${ep.slug}')">
              Ep ${idx+1}
            </button>
          `;
        });
        if (item.episodes.length) playEpisode(item.episodes[0].slug);
      }
    }

    function playEpisode(slug) {
      document.getElementById("player").src = `https://burnedplayer.pages.dev/player?v=${slug}`;
    }

    loadVideo();
  </script>
</body>
</html>
