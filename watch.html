<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Watch - BurnedStream</title>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .ep-btn { padding: 0.5rem; font-size: 0.85rem; border-radius: 0.5rem; background:#1f2937; }
    .ep-btn:hover { background:#dc2626; }
  </style>
</head>
<body class="bg-gray-900 text-white">
  <!-- Banner -->
  <div class="relative h-[40vh] md:h-[55vh] flex items-end">
    <img id="backdrop" class="absolute inset-0 w-full h-full object-cover opacity-40">
    <div class="relative flex items-center gap-3 p-3 md:p-6">
      <img id="poster" class="w-20 md:w-36 rounded shadow-lg">
      <div>
        <h1 id="title" class="text-lg md:text-3xl font-bold"></h1>
        <p id="desc" class="text-xs md:text-base my-2 line-clamp-3"></p>
        <p class="text-yellow-400 text-sm">⭐ <span id="rating"></span></p>
      </div>
    </div>
  </div>

  <!-- Player -->
  <div class="w-full h-[45vh] md:h-[70vh] bg-black">
    <iframe id="player" class="w-full h-full" allowfullscreen></iframe>
  </div>

  <!-- Episodes -->
  <div id="episodes" class="p-3 hidden">
    <h2 class="text-base md:text-xl font-bold mb-3">Episodes</h2>
    <div id="epList" class="grid grid-cols-2 md:grid-cols-6 gap-2"></div>
  </div>

  <script>
    const API = "https://crew-auth.vercel.app/api";
    const params = new URLSearchParams(window.location.search);
    const id = params.get("id");
    const type = params.get("type");

    async function loadVideo() {
      if (!id || !type) {
        document.body.innerHTML = "<h1 class='text-center mt-20'>❌ Invalid request</h1>";
        return;
      }

      let endpoint = type === "tv" ? "series" : "content";
      let res = await axios.get(`${API}/${endpoint}`);
      let item = res.data.find(x => x._id === id);
      if (!item) {
        document.body.innerHTML = "<h1 class='text-center mt-20'>❌ Not found</h1>";
        return;
      }

      // Posters & backdrop
      let poster = item.poster;
      let backdrop = poster;
      if (poster.includes("image.tmdb.org")) {
        backdrop = poster.replace("/w500","/w780");
        poster = poster.replace("/w500","/w342");
      }
      document.getElementById("poster").src = poster;
      document.getElementById("backdrop").src = backdrop;
      document.getElementById("title").innerText = item.title;
      document.getElementById("desc").innerText = item.description;
      document.getElementById("rating").innerText = item.rating || "N/A";

      if (type === "movie") {
        document.getElementById("player").src = `https://burnedplayer.pages.dev/player?v=${item.slug}`;
      }

      if (type === "tv") {
        document.getElementById("episodes").classList.remove("hidden");
        let epList = document.getElementById("epList");
        epList.innerHTML = "";
        item.episodes.forEach((ep, idx) => {
          epList.innerHTML += `
            <button class="ep-btn" onclick="playEpisode('${ep.slug}')">Ep ${idx+1}</button>
          `;
        });
        if (item.episodes.length) playEpisode(item.episodes[0].slug);
      }
    }

    function playEpisode(slug) {
      document.getElementById("player").src = `https://burnedplayer.pages.dev/player?v=${slug}`;
    }

    loadVideo();
  </script>
</body>
</html>
